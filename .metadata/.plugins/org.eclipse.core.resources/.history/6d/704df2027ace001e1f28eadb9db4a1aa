package weatherInformation;

import java.io.InputStreamReader;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.net.URL;
import java.net.URLConnection;
import java.util.HashMap;
import java.util.Map;

import com.google.gson.*;
import com.google.gson.reflect.*;

public class weatherInformation {

	 public static Map<String, Object> jsonToMap(String str) 
	 {
		 
	        if (str == null || str.isEmpty()) 
	        {
	            throw new IllegalArgumentException("JSON string is null or empty");
	        }
	        	        
	        return new Gson().fromJson(
	        		str, new TypeToken<HashMap<String, Object>>() {}.getType()
	        		);
	   
	 }
	 
	public static Map <String, Object> getWeatherInformation(String country, String city){
		
		// Datei auslesen um auf den API Key zugreifen zu k√∂nnen
		
		String API_KEY = null;
		
		try (BufferedReader reader = new BufferedReader(new FileReader("../weather/src/API.txt")))
		{
			
			String zeile ;
			
			while ((zeile = reader.readLine()) != null)
			{
				API_KEY = zeile;
			}
			
			
		}catch (FileNotFoundException fileNotFound)
		{
			fileNotFound.printStackTrace();
		}catch (IOException ioException) 
		{
			ioException.printStackTrace();
		}catch (Exception exception)
		{
			exception.printStackTrace();
		}
		
		String LOCATION = city + "," + country;
		String urlString = "http://api.openweathermap.org/data/2.5/weather?q=" + LOCATION + "&appid=" + API_KEY + "&units=metric";
		
		Map <String, Object> weatherData = new HashMap<>();
		
		try 
		{
			StringBuilder result = new StringBuilder();
			URL url = new URL(urlString);
			URLConnection conn = url.openConnection();
			BufferedReader rd = new BufferedReader(new InputStreamReader(conn.getInputStream()));
			String line;
			
			while((line = rd.readLine()) != null) 
			{
				result.append(line);
			}
			rd.close();
			
			System.out.println(result);
			
			Map<String, Object> respMap = jsonToMap(result.toString());
			System.out.println(respMap);
			Map<String, Object> weatherMap = jsonToMap(respMap.get("weather").toString());
			System.out.println(weatherMap);
			Map<String, Object> mainMap = jsonToMap(respMap.get("main").toString());
			Map<String, Object> windMap = jsonToMap(respMap.get("wind").toString());
			
			weatherData.put("weather", weatherMap.get("main"));
			
			weatherData.put("current temp", mainMap.get("temp"));
			
//			weatherData.put("feels_like", mainMap.get("feels_like"));
			
			weatherData.put("wind Speed", windMap.get("speed"));
			
//			weatherData.put("wind_angle", windMap.get("deg"));
			
			return weatherData;
			
		}catch(IOException ioException) 
		{
			System.out.println(ioException.getMessage());
			System.out.println("hallo");
		}catch(Exception exception) 
		{
			System.out.println(exception.getMessage());
			System.out.println("hallo2");
		}
		
		return weatherData;
		
	}
}

